apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  name: istiod-sidecar-injector-cluster
webhooks:
  - name: istiod.istio.io
    clientConfig:
      service:
        name: istiod
        namespace: istio-system
        path: "/inject"
      caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURDekNDQWZPZ0F3SUJBZ0lRSGYyTmlFa3ArU1d0WE95TmZpVFk1REFOQmdrcWhraUc5dzBCQVFzRkFEQXYKTVMwd0t3WURWUVFERXlSbE9XWTNZelJoTVMwMU16SXlMVFJtTkdZdFlXVXdOQzFtWkRNd09HTmhZV0k1WTJRdwpIaGNOTVRreE1ESTVNVGt4TnpReVdoY05NalF4TURJM01qQXhOelF5V2pBdk1TMHdLd1lEVlFRREV5UmxPV1kzCll6UmhNUzAxTXpJeUxUUm1OR1l0WVdVd05DMW1aRE13T0dOaFlXSTVZMlF3Z2dFaU1BMEdDU3FHU0liM0RRRUIKQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUURBVWdic2tiMWJNY1ltQ0h4d3d4OU5ndVc0MHFVM1BmN2N2dDF5UDhxTApMTjFCUWJYZWRwcnNuSTNia1owS2srSmlVUGoxc2pOeGI2QS9QRytsdXYrd2JsR1h0VXpzTmllSXgzYTRFclVJCjNST0I3YldWbXBrZmVPVEZHUHhwRUhVRVpoeXJ6QzdWaWNZeGc4Y1NsL1NVdjNkTU0veGFGSktod0Ixbks2N24KM3R2eG10ZDhOWnFQUmVxZ0J5UHEzelRGcVA2UHpBVFpMQk44STZldGtaSGs3anZUemU2aHNvNWx0VWw4Tml1MApJdFFOdjVVM212ZjBpMXVPYkhka1o2UXExZXNnTENXaldDOWxwcS82aDdVd0doNDVQajZwUjdMWERxZU5MOUptCklGcjZzYlNDa3dHS2dBanpZaDh2a3cxRmNJVEF2cm0xdS9lMjVOZ211QmRKQWdNQkFBR2pJekFoTUE0R0ExVWQKRHdFQi93UUVBd0lDQkRBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFCdwozeHoyQTR1TVdwdjkxOHRWODJvUXVrN0NWVTlSTTl5KytrZjVHL0s4ZVdPUFhTb3JzeVFDOGxaVlNoeDluN0xxCkhHTm9PYkpGQzFxMlo4TzR6dy9Ya0R6Zy9MRFNPY2JLQ3h5YnZiY2c5WTlSK2dnc1FsYzF5QkQyd0l6ZGRFU0IKRStIb0JMV0M2T0o5R0E5SEdFWkdyU2M1UWFFV2NzWWpJeDBoWDAvTEFOVS9ad1VEd3dSWXJ3RjFNL2Z6SnpmMgpnNjNWdzl4Ykt5NCswTVoxUFhXajZpVWx6NEErcTF1bHlQWmhHbjIyV1g2cW1aT2xjL3VZSUxQZ1dPc1VEaU5yCit4cTlzVTdhL2hTWnFPdlRxS25uckJ3S2VaLytQaEFqeXdtOXI5SEoyVmV0R2UwcDJMK0pucXBLL1NkdzJVMFoKVkVoNERzN2JZeWVlTDB2WUk1UUQKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
    rules:
      - operations: [ "CREATE" ]
        apiGroups: [""]
        apiVersions: ["v1"]
        resources: ["pods"]
    failurePolicy: Fail
    namespaceSelector:
      matchExpressions:
      - key: istio-injection
        operator: NotIn
        values:
        - disabled
      - key: istio-env
        operator: DoesNotExist
